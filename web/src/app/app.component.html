<mat-card appearance="outlined" class="container_card">
  <mat-card-content>
    <!-- Control value: {{myControl.value || 'empty'}} -->
    <h2>Facturaci√≥n de venta</h2>
    <form class="form" [formGroup]="salesForm">
      <mat-form-field >
        <mat-label>Cliente</mat-label>
        <input #input type="text" placeholder="Seleccione un cliente" matInput formControlName="clients"
          [matAutocomplete]="autoClients" (input)="filtereClients()" (focus)="filtereClients()">
        <mat-autocomplete requireSelection #autoClients="matAutocomplete">
          <mat-option *ngFor="let client of clients" [value]="client.cli_name">
            {{client.cli_name}}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
      <button class="btnAdd" mat-fab aria-label="add client" (click)="openAddClient()">
        <mat-icon>add</mat-icon>
      </button>
        <mat-form-field class="product_container">
          <mat-label>Producto</mat-label>
          <input #input type="text" placeholder="Seleccione un producto" matInput formControlName="products"
            [matAutocomplete]="autoProducts" (input)="filtereProducts()" (focus)="filtereProducts()">
          <mat-autocomplete requireSelection #autoProducts="matAutocomplete">
            <mat-option *ngFor="let product of products" [value]="product.pro_name">
              {{product.pro_name}}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      <button class="btnAdd" mat-fab aria-label="add client" (click)="openAddProduct()">
        <mat-icon>add</mat-icon>
      </button>
      <button class="btnAddToCart" style="background-color: #4177d9; color: white;"
       mat-fab aria-label="add client" (click)="addProductToCart()" [disabled]="salesForm.get('products')?.value == ''">
        <mat-icon>add_shopping_cart
        </mat-icon>
      </button>
    </form>

    <table mat-table [dataSource]="sales" class="mat-elevation-z8" class="mt-3">
      <ng-container matColumnDef="pro_name">
        <th class="start" mat-header-cell *matHeaderCellDef> Producto</th>
        <td mat-cell *matCellDef="let element"> {{element.pro_name}} </td>
      </ng-container>

      <ng-container matColumnDef="pro_sale_amount">
        <th mat-header-cell *matHeaderCellDef> Valor </th>
        <td mat-cell *matCellDef="let element"> {{currencyFormatter("USD",element.pro_sale_amount)}} </td>
      </ng-container>


      <ng-container matColumnDef="pro_iva_percentage">
        <th mat-header-cell *matHeaderCellDef> Iva </th>
        <td mat-cell *matCellDef="let element"> {{element.pro_iva_percentage || 0}}% </td>
      </ng-container>

      <ng-container matColumnDef="pro_id">
        <th class="start" mat-header-cell *matHeaderCellDef> Eliminar</th>
        <td mat-cell *matCellDef="let element; let i = index">
          <button mat-icon-button (click)="removeProductFromCart(i)">
            <mat-icon style="color:rgb(185, 0, 0)">delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
    <mat-divider></mat-divider>
    <h6 style="margin-top: 0.7rem;">Total: {{currencyFormatter("USD",total)}}</h6>
    <mat-divider></mat-divider>
    <mat-card-actions align="end">
      <button mat-fab extended style="background-color: #4177d9; color: white;" (click)="generateSalesInvoice()"
      [disabled]="!salesForm.valid || total==0">
        <mat-icon>save</mat-icon>
        Guardar venta
      </button>
    </mat-card-actions>
  </mat-card-content>
</mat-card>
<div class="view_sales">
  <button mat-fab style="background-color: #4177d9; color: white;" (click)="openSalesList()">
    <mat-icon>receipt_long</mat-icon>
  </button>
</div>